<div class="container-sm">

    <nav class="navbar navbar-expand-lg bg-secondary-subtle mb-1">
        <div class="container-fluid">
            <h4>PERMUTAS</h4>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item ms-2">
                        <a href="/principal" class="btn btn-outline-dark"><i class="fa-solid fa-chevron-left"></i> Voltar</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-sm">
        <p>Filtro</p>
        <form action="/permuta/buscar" method="post">

            <div class="row">
                <div class="col-3">
                    <select name="busca" id="busca" class="form-select">
                        <option value="3" {{#if (eq status '3')}}selected{{/if}}>Todas</option>
                        <option value="0" {{#if (eq status '0')}}selected{{/if}}>Pendentes</option>
                        <option value="1" {{#if (eq status '1')}}selected{{/if}}>Abertas</option>
                        <option value="2" {{#if (eq status '2')}}selected{{/if}}>Fechadas</option>
                    </select>
                </div>
                <div class="col-1">
                    <button class="btn btn-sm btn-primary">Buscar</button>
                </div>
            </div>

        </form>
    </div>

    <!-- PERMUTAS PENDENTES -->
    {{#each permutas}}
        <div class="shadow-sm mt-3 p-3 rounded rounded-1 border border-1 bg-body-tertiary">
            <nav class="bg-body-secondary mb-3">
                <ul class="nav justify-content-end">

                    {{#if (eq status 0)}}
                        <li class="nav-item">
                            <a class="nav-link" href="#">SUAP</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/permuta/abrir/{{id}}">ABRIR</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="excluir({{id}})">EXCLUIR</a>
                        </li>
                    {{/if}}

                    {{#if (eq status 1)}}
                        <li class="nav-item">
                            <a class="nav-link" href="#">SUAP</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/permuta/fechar/{{id}}">FECHAR</a>
                        </li>
                    {{/if}}
                </ul>
            </nav>
            <div class="row mb-2">
                <div class="col">
                    <strong>PROFESSOR: </strong> {{diario.professor.nome}}
                </div>
                <div class="col-sm">
                    <strong>JUSTIFICATIVA: </strong> {{justificativa}}
                </div>
                <div class="col-sm-1">
                    <span class="badge {{corPermuta status}}">
                        {{statusPermuta status}}
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3">
                    <strong>DIÁRIO</strong>: {{diario.descricao}}
                </div>
                <div class="col-sm-3">
                    <strong>TURMA </strong>: {{diario.turma.descricao}}
                </div>
                <div class="col-sm-2">
                    <strong>DATA</strong>: {{formatDate data}}
                </div>
                <div class="col-sm-2">
                    <strong>DIA</strong>: {{dia}}
                </div>
                <div class="col-sm-2">
                    <strong>HORARIOS</strong>: {{horarios}}
                </div>

            </div>
            <hr class="m-0 p-0">
            <div class="row mt-3">
                <div class="col-sm">
                    <strong>SUBSTITUTO: </strong> {{substituto.professor.nome}}
                </div>

                <div class="col-sm">
                    <strong>DIÁRIO</strong>: {{substituto.descricao}}
                </div>

            </div>
        </div>
    {{/each}}

    <!-- Modal -->
<div class="modal fade" id="permutaModal" tabindex="-1" aria-labelledby="permutaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="permutalModalLabel">Detalhes da Permuta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>DIARIO:</strong> <span id="modalDiario"></span></p>
                <p><strong>SUBSTITUTO:</strong> <span id="modalSubstituto"></span></p>
                <p><strong>DATA:</strong> <span id="modalData"></span></p>
                <p><strong>DIA:</strong> <span id="modalDia"></span></p>
                <p><strong>HORÁRIOS:</strong> <span id="modalHorario"></span></p>
                <p><strong>JUSTIFICATIVA:</strong> <span id="modalJustificativa"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
</div>
<script>

    function filtrar(){
        var select = document.getElementById('status')
        alert(select.value)
    }
    function excluir(id){
        if(confirm('Deseja realmente excluir a Permuta?')){
            document.location.href = '/permuta/delete/'+id
        }
    }
    function abrir(id){
        if(confirm('Deseja abrir a Permuta?')){
            document.location.href = '/permuta/abrir/'+id
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("permutaModal"));

        document.querySelectorAll(".verDetalhes").forEach(button => {
            button.addEventListener("click", function () {
                // Pega os atributos data-* do botão
                document.getElementById("modalDiario").textContent = this.getAttribute("data-diario");
                document.getElementById("modalSubstituto").textContent = this.getAttribute("data-substituto");
                document.getElementById("modalData").textContent = this.getAttribute("data-data");
                document.getElementById("modalDia").textContent = this.getAttribute("data-dia");
                document.getElementById("modalHorario").textContent = this.getAttribute("data-horario");
                document.getElementById("modalJustificativa").textContent = this.getAttribute("data-justificativa");

                // Abre o modal
                modal.show();
            });
        });
    });
</script>

</div>